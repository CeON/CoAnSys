<workflow-app name='disambiguation-with-import-wf' xmlns="uri:oozie:workflow:0.2">
    <start to='import'/>
    <action name="import">
        <sub-workflow>
            <app-path>${importerApplicationPath}</app-path>
            <propagate-configuration/>
        </sub-workflow>
        <ok to="disambiguation"/>
        <error to="kill"/>
    </action>   
    <action name="disambiguation">
        <sub-workflow>
            <app-path>${disambiguationApplicationPath}</app-path>
            <propagate-configuration/>
        </sub-workflow>
        <ok to="email"/>
        <error to="kill"/>
    </action>
    <action name="email">
        <email xmlns="uri:oozie:email-action:0.1">
            <to>kawa.adam@gmail.com</to>
            <cc>pdendek@icm.edu.pl</cc>
            <subject>Email notifications for ${wf:id()}</subject>
            <body>The wf ${wf:id()} successfully completed.
                1. Import form ${zipDirPath} to ${hbaseTableName} via HBase REST on ${restHost}:${restPort}.
                2. Disambiguation form ${hbaseInputTable} to ${hbaseOutputTable} 
                        with featureDescription=${featureDescription} and threshold=${threshold}.
            </body>
        </email>
        <ok to="end"/>
        <error to="kill"/>
    </action>
    <kill name='kill'>
        <message>Workflow failed, error message[${wf:errorMessage(wf:lastErrorNode())}]</message>
    </kill>
    <end name='end'/>
</workflow-app>